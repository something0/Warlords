t = {{x=0 ,y=0 }, {x=25 ,y=0 }, {x=50 ,y=0 }, {x=75 ,y=0 }, {x=100 ,y=0 }, {x=125,y=0}, {x=150, y=0},
     {x=0 ,y=25}, {x=25 ,y=25}, {x=50 ,y=25}, {x=75 ,y=25}, {x=100 ,y=25}, {x=125,y=25},{x=150,y=25},
     {x=0 ,y=50}, {x=25 ,y=50}, {x=50 ,y=50}, {x=75 ,y=50}, {x=100 ,y=50}, {x=125,y=50}, {x=150,y=50},
     {x=0 ,y=75}, {x=25 ,y=75}, {x=50 ,y=75}, {x=75 ,y=75}, {x=100 ,y=75}, {x=125,y=75},{x=150,y=75},
     {x=0,y=100}, {x=25,y=100}, {x=50,y=100}, {x=75,y=100}, {x=100,y=100}, {x=125,y=100},{x=150,y=100},
     {x=0,y=125}, {x=25,y=125}, {x=50,y=125}, {x=75,y=125}, {x=100,y=125}, {x=125,y=125},{x=150,y=125},
     {x=0,y=150}, {x=25,y=150}, {x=50,y=150}, {x=75,y=150}, {x=100,y=150}, {x=125,y=150}, {x=150,y=150}}

P2 =  {{x=1130 ,y=0 }, {x=1155 ,y=0 }, {x=1180 ,y=0 }, {x=1205 ,y=0 }, {x=1230 ,y=0 }, {x=1255,y=0}, {x=1280, y=0},
       {x=1130 ,y=25}, {x=1155 ,y=25}, {x=1180 ,y=25}, {x=1205 ,y=25}, {x=1230 ,y=25}, {x=1255,y=25},{x=1280,y=25},
       {x=1130 ,y=50}, {x=1155 ,y=50}, {x=1180 ,y=50}, {x=1205 ,y=50}, {x=1230 ,y=50}, {x=1255,y=50}, {x=1280,y=50},
       {x=1130 ,y=75}, {x=1155 ,y=75}, {x=1180 ,y=75}, {x=1205 ,y=75}, {x=1230 ,y=75}, {x=1255,y=75},{x=1280,y=75},
       {x=1130,y=100}, {x=1155,y=100}, {x=1180,y=100}, {x=1205,y=100}, {x=1230,y=100}, {x=1255,y=100},{x=1280,y=100},
       {x=1130,y=125}, {x=1155,y=125}, {x=1180,y=125}, {x=1205,y=125}, {x=1230,y=125}, {x=1255,y=125},{x=1280,y=125},
       {x=1130,y=150}, {x=1155,y=150}, {x=1180,y=150}, {x=1205,y=150}, {x=1230,y=150}, {x=1255,y=150}, {x=1280,y=150}}

P3 = {{x=0 ,y=615}, {x=25 ,y=615 }, {x=50 ,y=615 }, {x=75 ,y=615 }, {x=100 ,y=615 }, {x=125,y=615}, {x=150, y=615},
      {x=0 ,y=640}, {x=25 ,y=640}, {x=50 ,y=640}, {x=75 ,y=640}, {x=100 ,y=640}, {x=125,y=640},{x=150,y=640},
      {x=0 ,y=665}, {x=25 ,y=665}, {x=50 ,y=665}, {x=75 ,y=665}, {x=100 ,y=665}, {x=125,y=665}, {x=150,y=665},
      {x=0 ,y=690}, {x=25 ,y=690}, {x=50 ,y=690}, {x=75 ,y=690}, {x=100 ,y=690}, {x=125,y=690},{x=150,y=690},
      {x=0,y=715}, {x=25,y=715}, {x=50,y=715}, {x=75,y=715}, {x=100,y=715}, {x=125,y=715},{x=150,y=715},
      {x=0,y=740}, {x=25,y=740}, {x=50,y=740}, {x=75,y=740}, {x=100,y=740}, {x=125,y=740},{x=150,y=740},
      {x=0,y=765}, {x=25,y=765}, {x=50,y=765}, {x=75,y=765}, {x=100,y=765}, {x=125,y=765}, {x=150,y=765}}

P4 = {{x=1130 ,y=615 }, {x=1155 ,y=615 }, {x=1180 ,y=615 }, {x=1205 ,y=615 }, {x=1230 ,y=615 }, {x=1255,y=615}, {x=1280, y=615},
      {x=1130 ,y=640}, {x=1155 ,y=640}, {x=1180 ,y=640}, {x=1205 ,y=640}, {x=1230 ,y=640}, {x=1255,y=640},{x=1280,y=640},
      {x=1130 ,y=665}, {x=1155 ,y=665}, {x=1180 ,y=665}, {x=1205 ,y=665}, {x=1230 ,y=665}, {x=1255,y=665}, {x=1280,y=665},
      {x=1130 ,y=690}, {x=1155 ,y=690}, {x=1180 ,y=690}, {x=1205 ,y=690}, {x=1230 ,y=690}, {x=1255,y=690},{x=1280,y=690},
      {x=1130,y=715}, {x=1155,y=715}, {x=1180,y=715}, {x=1205,y=715}, {x=1230,y=715}, {x=1255,y=715},{x=1280,y=715},
      {x=1130,y=740}, {x=1155,y=740}, {x=1180,y=740}, {x=1205,y=740}, {x=1230,y=740}, {x=1255,y=740},{x=1280,y=740},
      {x=1130,y=765}, {x=1155,y=765}, {x=1180,y=765}, {x=1205,y=765}, {x=1230,y=765}, {x=1255,y=765}, {x=1280,y=765}}

WINDOW_HEIGHT = 720
WINDOW_WIDTH = 1280

B1X = 200
B1Y = 200
B1W = 15
B1H = 15

B2X = 1100
B2Y = 200
B2W = 15
B2H = 15

B3X = 200
B3Y = 565
B3W = 15
B3H = 15

B4X = 1100
B4Y = 565
B4W = 15
B4H = 15

Ball1X = WINDOW_WIDTH / 2
Ball1Y = WINDOW_HEIGHT / 2
BH = 12
BW = 12 

P1GamePad = false
P2GamePad = false
P3GamePad = false 
P4GamePad = false

BatSpeed = 200
BallSpeed = 600

state = 'Menu'


if state == 'Menu' then
    function love.load()
        local joysticks = love.joystick.getJoysticks()
            joystick = joysticks[1]
            joystick2 = joysticks[2]
            joystick3 = joysticks[3]
            
    
            P1Active = true
            P2Active = true 
            P3Active = true
            P4Active = true
            Direction = love.math.random(-250,250)
            XDirection = love.math.random(-1,1)
        love.window.setMode(WINDOW_WIDTH, WINDOW_HEIGHT, {
            fullscreen = true,
            resizable = true,
            vsync = true
        })
    end

    function love.draw()

        love.graphics.rectangle('fill', WINDOW_WIDTH/2/2, WINDOW_HEIGHT/3.5, WINDOW_WIDTH/1.7, 75)
        end
        love.graphics.printf("Press enter to serve", 60, 35, 3800, "center")

    function love.mousepressed(x,y,button) 
        if button == 1 then 
            if x >= WINDOW_WIDTH/2/2 and x <= WINDOW_WIDTH + WINDOW_WIDTH/1.7 and y >= WINDOW_HEIGHT/3.5 and y <= WINDOW_HEIGHT/3.5 + 75 then
                state = 'inGame'

            end 
        end
    end

end 

function love.update(dt)
    if state == 'inGame' then 
        function love.load()
    
            
            love.window.setMode(WINDOW_WIDTH, WINDOW_HEIGHT, {
                fullscreen = true,
                resizable = true,
                vsync = true
            })
        end
        function love.draw()
            if P1Active == true then
                Bat1 = love.graphics.rectangle('line', B1X, B1Y, B1W,B1H)
                Base1 = love.graphics.rectangle('line', 0,0,75,75)
                for i,v in ipairs(t) do
                    love.graphics.rectangle('fill', v.x, v.y, 25,25)
                end
            end
    
            if P2Active == true then
                for i,v in ipairs(P2) do
                    love.graphics.rectangle('fill', v.x, v.y, 25,25)
                end
                Bat2 = love.graphics.rectangle('line', B2X, B2Y, B2W,B2H)
                Base2 = love.graphics.rectangle('line', 1230,0,75,75)
            end
    
            if P3Active == true then
                for i,v in ipairs(P3) do
                    love.graphics.rectangle('fill', v.x, v.y, 25,25)
                end
                Bat3 = love.graphics.rectangle('line', B3X, B3Y, B3W,B3H)
                Base3 = love.graphics.rectangle('line', 0,715,75,75)
            end
        
            if P4Active == true then
                for i,v in ipairs(P4) do
                    love.graphics.rectangle('fill', v.x, v.y, 25,25)
                end
                Bat3 = love.graphics.rectangle('line', B4X, B4Y, B4W,B4H)
                Base3 = love.graphics.rectangle('line', 1230,715,75,75)
            end
        
            Ball1 = love.graphics.rectangle('fill', Ball1X , Ball1Y , BW,BH)
            
        end
    
        function collisionDetected(x1,y1,x2,y2,d1,d2)
            -- Uses the x and y coordinates of two different points along with a diameter around them.
            -- As long as these two diameters collide/overlap, this function returns true!
            -- If d1 and/or d2 is missing, use the a default diameter of 1 instead.
            local d1 = d1 or 1
            local d2 = d2 or 1
            local delta_x = x2 - x1
            local delta_y = y2 - y1
            local delta_d = (d1 / 2) + (d2 / 2)
            if ( delta_x^2 + delta_y^2 < delta_d^2 ) then
                return true
            end
        end
    
        function love.update(dt)
    
            
            if P1Active == true then
            --The entirety of the Player1's movement system
                if love.keyboard.isDown("w") then
                    B1Y = B1Y - (BatSpeed * dt)
                    lockOnW = false
                else
                    lockOnW = true 
                end
    
                if love.keyboard.isDown("s") then 
                    B1Y = B1Y + (BatSpeed * dt)
                    lockOnS = false
                else 
                    lockOnS = true
                end
    
                if love.keyboard.isDown("lshift") then
                    shiftDown = true
                else 
                    shiftDown = false
                end
                
                if love.keyboard.isDown("a") then
                    B1X = B1X - (BatSpeed * dt)
                    lockOnA = false
                else 
                    lockOnA = true
                end
    
                if love.keyboard.isDown("d") then 
                    B1X = B1X + (BatSpeed * dt)
                    lockOnD = false
                else
                    lockOnD = true
                end
                
                if lockOnW == true and lockOnS == true and shiftDown == false then
                    B1Y = 200
                end
    
                if lockOnA == true and lockOnD == true and shiftDown == false then
                    B1X = 200
                end
            
                --All the collides for Player1's bat 
                if B1Y > 197 then
                    B1Y = 200
                end
    
                if B1Y < 0 then
                    B1Y = 0
                end
                if B1Y > 200 then
                    B1Y = 199
                end
            
                if B1X < 0 then
                    B1X = 0
                end
                if B1X > 200 then
                    B1X = 199
                end
            
                if B1Y > 198 then
                    if B1X < 198 then
                        B1Y = 198
                    end
                else
                    if B1X < 198 then
                        B1X = 199
                    end
                end
            
                if (B1X > Ball1X + BW) or (B1Y > Ball1Y + BH) or (B1X + B1W < Ball1X) or (B1Y + B1H < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                end
            
                if (0 > Ball1X + BW) or (0 > Ball1Y + BH) or (0 + 75 < Ball1X) or (0 + 75 < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                    P1Active = false
                end
    
                --The collision for Player1's defense system, referring to the table currently named 't' (this is set to change)
                for i, rect in ipairs(t) do
    
                    if ( collisionDetected(rect.x, rect.y, Ball1X, Ball1Y, 25, 12) ) then
                        --Makes the ball bounce
                        --Removes individual squares from the defense
                        xBounce()
                        table.remove(t,i) 
                    end
                end
                
                
                
            else 
            end
    
        --Handles the corners of the screen in which the ball can collide with 
            if Ball1Y < 0 then
                Ball1Y = 0
                yBounce()
            end
    
            if Ball1Y > 720 then
                Ball1Y = 720
                yBounce()
            end
    
            if Ball1X < 0 then 
                Ball1X = 0
                xBounce()
            end
    
            if Ball1X > 1280 then
                Ball1X = 1270
                xBounce()
            end
            --Generates a new number for the direction if it was previously set to nil on start
            if XDirection == 0 then
                XDirection = love.math.random(-1,1)
            end
            
            --The general movement of the ball throughout the game
            Ball1X = Ball1X - XDirection * (BallSpeed * dt)
            Ball1Y = Ball1Y - (Direction * dt)
            
            --Sets a terminal velocity for the ball
            if BallSpeed > 1450 then 
                BallSpeed = 1450
            end
    
            if P2Active == true then
    
            --Player2's collision system 
                for i, rect in ipairs(P2) do
    
                    if ( collisionDetected(rect.x, rect.y, Ball1X, Ball1Y, 25, 12) ) then
                        --Makes the ball bounce
                        --Removes individual squares from the defense
                        xBounce()
                        table.remove(P2,i)
                    end
                end
                
            --Player2's movement system
                if not joystick then return
                     if love.keyboard.isDown("up") then
                         B2Y = B2Y - (BatSpeed * dt)
                         lockOnUp = false
                     else
                         lockOnUp = true 
                     end
         
                     if love.keyboard.isDown("down") then
                         B2Y = B2Y + (BatSpeed * dt)
                         lockOnDown = false
                     else
                         lockOnDown = true 
                     end
         
                     if love.keyboard.isDown("left") then
                         B2X = B2X - (BatSpeed * dt)
                         lockOnLeft = false
                     else
                         lockOnLeft = true 
                     end
         
                     if love.keyboard.isDown("right") then
                         B2X = B2X + (BatSpeed * dt)
                         lockOnRight = false
                     else
                         lockOnRight = true 
                     end
                     
                     if love.keyboard.isDown("rshift") then
                         rshiftDown = true
                     else 
                         rshiftDown = false 
                     end
         
                     if lockOnUp == true and lockOnDown== true and rshiftDown == false then
                         B2Y = 200 
                     end
         
                     if lockOnLeft == true and lockOnRight == true and rshiftDown == false then
                     B2X = 1100 
                     end
                end

                if joystick ~= nil then
				-- getGamepadAxis returns a value between -1 and 1.
                    -- It returns 0 when it is at rest
                    
                    Direction1 = joystick2:getGamepadAxis("leftx")
                    Direction2 = joystick2:getGamepadAxis("lefty")
    
                    B2X =  ((BatSpeed + 100)*dt) * P2Direction1 + B3X
                    B2Y =  ((BatSpeed +100)*dt) * P2Direction2 + B3Y
    
                    if joystick2:isGamepadDown("a") then
                        P2aDown = true
                    else 
                        P2aDown = false 
                    end
            
                    if P2aDown == true then
                        B2Y = 565
                    end
            
                    if P2aDown == true then
                    B2X = 200
                    end
			end
				
                --All the collides for Player2's bat 
                if B2Y > 197 then
                    B2Y = 200
                end
    
                if B2Y < 0 then
                    B2Y = 0
                end
    
                if B2X < 1100 then
                    B2X = 1100
                end
                if B2X > 1280 then
                    B2X = 1280
                end
            
                if B2Y > 198 then
                    if B2X > 1100 then
                        B2Y = 198
                    end
                else
                    if B2X > 1100 then
                        B2X = 1100
                    end
                end
            
                if (B2X > Ball1X + BW) or (B2Y > Ball1Y + BH) or (B2X + B2W < Ball1X) or (B2Y + B2H < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                end
            
                if (1205 > Ball1X + BW) or (0 > Ball1Y + BH) or (1205 + 75 < Ball1X) or (0 + 75 < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                    P2Active = false
                end
            end
    
            if P3Active == true then
                for i, rect in ipairs(P3) do
    
                    if ( collisionDetected(rect.x, rect.y, Ball1X, Ball1Y, 25, 12) ) then
                        --Makes the ball bounce
                        --Removes individual squares from the defense
                        xBounce()
                        table.remove(P3,i)
                    end
                end
    
                --Player2's movement system 
                if not joystick then return 
                end
                
                if joystick ~= nil then
                    -- getGamepadAxis returns a value between -1 and 1.
                    -- It returns 0 when it is at rest
                    
                    Direction1 = joystick:getGamepadAxis("leftx")
                    Direction2 = joystick:getGamepadAxis("lefty")
    
                    B3X =  ((BatSpeed + 100)*dt) * Direction1 + B3X
                    B3Y =  ((BatSpeed +100)*dt) * Direction2 + B3Y
    
                    if joystick:isGamepadDown("a") then
                        aDown = true
                    else 
                        aDown = false 
                    end
            
                    if aDown == true then
                        B3Y = 565
                    end
            
                    if aDown == true then
                    B3X = 200
                    end
                end
    
                
                
                --All the collides for Player3's bat 
                if B3Y < 565 then
                    B3Y = 565
                end
    
                if B3Y > 775 then
                    B3Y = 775
                end
    
                if B3X > 197 then
                    B3X = 200
                end
                if B3X < 0 then
                    B3X = 0
                end
            
                if B3Y > 563 then
                    if B3X < 197 then
                        B3Y = 565
                    end
                else
                    if B3X < 197 then
                        B3X = 200
                    end
                end
            
                if (B3X > Ball1X + BW) or (B3Y > Ball1Y + BH) or (B3X + B3W < Ball1X) or (B3Y + B3H < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                end
            
                if (0 > Ball1X + BW) or (715 > Ball1Y + BH) or (0 + 75 < Ball1X) or (715 + 75 < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                    P3Active = false
                end
            
            end
    
            if P4Active == true then
                    for i, rect in ipairs(P4) do
            
                        if ( collisionDetected(rect.x, rect.y, Ball1X, Ball1Y, 25, 12) ) then
                            --Makes the ball bounce
                            --Removes individual squares from the defense
                            xBounce()
                            table.remove(P4,i)
                        end
                    end
            
                    --Player2's movement system 
                    if not joystick2 then return 
                    end
                    
                    if joystick ~= nil then
                        -- getGamepadAxis returns a value between -1 and 1.
                        -- It returns 0 when it is at rest
                        
                        Direction1P4 = joystick2:getGamepadAxis("leftx")
                        Direction2P4 = joystick2:getGamepadAxis("lefty")
            
                        B4X =  ((BatSpeed + 100)*dt) * Direction1P4 + B4X
                        B4Y =  ((BatSpeed +100)*dt) * Direction2P4 + B4Y
            
                        if joystick2:isGamepadDown("a") then
                            aDown2 = true
                        else 
                            aDown2 = false 
                        end
                
                        if aDown2 == true then
                            B4Y = 565
                        end
                
                        if aDown2 == true then
                        B4X = 200
                        end
                    end
    
                    --All the collides for Player3's bat 
                if B4Y < 565 then
                    B4Y = 565
                end
    
                if B4Y > 775 then
                    B4Y = 775
                end
    
                if B4X > 1280 then
                    B4X = 1280
                end
                if B4X < 1099 then
                    B4X = 1099
                end
            
                if B4Y > 563 then
                    if B4X > 1100 then
                        B4Y = 565
                    end
                else
                    if B4X < 1100 then
                        B4X = 1100
                    end
                end
            
                if (B4X > Ball1X + BW) or (B4Y > Ball1Y + BH) or (B4X + B4W < Ball1X) or (B4Y + B4H < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                end
            
                if (1130 > Ball1X + BW) or (715 > Ball1Y + BH) or (1130 + 75 < Ball1X) or (715 + 75 < Ball1Y) then 
                    love.graphics.print("no collision")
                else
                    xBounce()
                    P4Active = false
                end
            end
        end
    
        --Handles which direction the ball should go depending on which function is used when it collides with another gameObject
        function xBounce()
            Direction = love.math.random(-250,250)
            --Direction = -Direction
            XDirection = -XDirection
            BallSpeed = BallSpeed * 1.03
        end
    
        function yBounce()
            Direction = -Direction
            BallSpeed = BallSpeed * 1.03
        end
    end
    
end
